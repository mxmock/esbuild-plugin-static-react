"use strict";var X=Object.create;var w=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var tt=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty;var et=(t,r)=>{for(var e in r)w(t,e,{get:r[e],enumerable:!0})},D=(t,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of Z(r))!rt.call(t,s)&&s!==e&&w(t,s,{get:()=>r[s],enumerable:!(n=Y(r,s))||n.enumerable});return t};var a=(t,r,e)=>(e=t!=null?X(tt(t)):{},D(r||!t||!t.__esModule?w(e,"default",{value:t,enumerable:!0}):e,t)),nt=t=>D(w({},"__esModule",{value:!0}),t);var gt={};et(gt,{default:()=>pt});module.exports=nt(gt);var h=a(require("path"));var y=a(require("path")),W=a(require("sass")),E=a(require("postcss")),T=a(require("cssnano")),A=a(require("autoprefixer"));var C=a(require("path")),j=require("html-minifier-terser");var u=require("fs"),b=t=>new Promise((r,e)=>{(0,u.mkdir)(t,{recursive:!0},n=>{n&&e(n.message),r("Create folder ok")})}),S=t=>new Promise((r,e)=>{(0,u.rm)(t,{recursive:!0,force:!0},n=>{n&&e(n.message),r("Delete ok")})});var f=require("fs"),st=(t,r="utf8")=>(t.setEncoding(r),new Promise((e,n)=>{let s="";t.on("data",o=>{s+=o}),t.on("end",()=>e(s)),t.on("error",o=>n(o))})),k=(t,r)=>(t.write(r),t.end(),new Promise((e,n)=>{t.on("finish",()=>e("Write stream finish")),t.on("error",s=>n(s.message))})),I=async t=>{let r="";try{let e=(0,f.createReadStream)(t,{highWaterMark:100}),n=await st(e);r=await(0,j.minify)(n,{caseSensitive:!0,collapseWhitespace:!0,conservativeCollapse:!0})}catch(e){console.error(e.message)}finally{return{path:t,content:r}}},O=async t=>{try{await b(C.default.dirname(t.path));let r=(0,f.createWriteStream)(t.path);await k(r,t.content)}catch(r){console.log(r)}},R=async(t,r)=>{try{await b(C.default.dirname(t));let e=(0,f.createWriteStream)(t);await k(e,r)}catch(e){console.log(e)}};var ot=t=>typeof t=="string",P=t=>ot(t)&&t.length>0;var N=a(require("cssnano-preset-default")),B=async(t,r,e,n)=>{if(!P(t)||!P(r))return;let s=(0,N.default)(),o=y.default.join(e,r,t);try{let{css:i}=await W.default.compileAsync(o),m=await(0,E.default)([(0,T.default)({preset:s,plugins:[A.default]})]).process(i,{from:void 0}),c=`${y.default.basename(t,".scss")}.css`,g=y.default.join(n,r,c);await R(g,`${m.css}`)}catch(i){console.error(i.message)}};var H=require("react-redux"),J=require("react-dom/server"),x=require("react/jsx-runtime"),L=(t,r,e)=>{let{id:n,Content:s}=t,o=`id="${n}"`,i=`data-${n}=`;if(!r.includes(o))return r;let m=r.indexOf(o),c=it(r,i,m),g=e?(0,x.jsx)(H.Provider,{store:e,children:(0,x.jsx)(s,{...c})}):(0,x.jsx)(s,{...c}),d=(0,J.renderToString)(g);return at(d,r,m,o.length+1)},it=(t,r,e)=>{if(!t.includes(r))return{};let n=t.indexOf(r)+r.length+1,s=e-2,o=t.substring(n,s);try{let i=JSON.parse(o);return console.log(`${r}`,i),i}catch(i){return console.error(`getComponentData - cannot parse ${o} from html:`,i.message),{}}},at=(t,r,e,n)=>{let s=r.substring(0,e+n),o=r.substring(e+n);return`${s}${t}${o}`};var F=a(require("path")),M=require("fs");var $=t=>new Promise((r,e)=>{(0,M.readdir)(t,{recursive:!0,withFileTypes:!0},(n,s)=>{n&&e(n),r(s)})}),U=async(t,r)=>{let e=await $(t),n=await $(r);return{jsFolder:e,cssFolder:n}},_=async t=>{let r=[];try{let e=F.default.resolve(t),s=(await $(e)).filter(o=>o.name.includes(".html")).map(o=>{let i=F.default.resolve(o.path,o.name);return I(i)});r=await Promise.all(s)}catch(e){console.error(e)}finally{return r}};var l=a(require("path")),q=(t,r,e)=>{let n=e.indexOf(r),s=e.slice(n+r.length);return l.default.join(t,s)},z=(t,r)=>{let{content:e,path:n}=t,{jsFolder:s,cssFolder:o}=r,i=ct(e),m=s.reduce(mt(n),""),c=o.reduce(lt(n),"");return i=i.replace(" </head>",`${c}</head>`),i.replace(" </body>",`${m}</body>`)},ct=t=>{let r=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>|<link\b[^>]*?rel="stylesheet"[^>]*?>/gi;return t.replace(r,"")},mt=t=>(r,e)=>{let n=l.default.relative(l.default.dirname(t),e.path),o=`<script defer async src="${l.default.join(n,e.name)}"></script>`;return`${r}${o} `},lt=t=>(r,e)=>{let n=l.default.relative(l.default.dirname(t),e.path),o=`<link rel="stylesheet" href="${l.default.join(n,e.name)}">`;return`${r}${o} `};var dt=(t={})=>({name:"staticReactPlugin",setup:r=>{let e=process.cwd(),n=t.css?.dir,s=t.store||null,o=t.css?.name,i=v(t.pagesDir),m=v(t.jsOutDir),c=v(t.srcDir,e),g=t.components||[],d=v(t.outDir||"build",e);r.onStart(async()=>{await S(d),await B(o,n,c,d)}),r.onEnd(async()=>{let G=await _(h.default.resolve(c,i)),K=await U(h.default.resolve(d,m),h.default.resolve(d,n)),Q=G.map(p=>{for(let V of g)p.content=L(V,p.content,s);return p.path=q(d,i,p.path),p.content=z(p,K),O(p)});await Promise.all(Q)})}}),v=(t,r=null)=>{if(!P(t))throw new Error("Path must be a valid string");return r?h.default.resolve(r,t):t},pt=dt;
